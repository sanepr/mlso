# MLflow 403 Access Denied Error - Troubleshooting Guide

## Error
```
Access to 0.0.0.0 was denied
You don't have authorisation to view this page.
HTTP ERROR 403
```

---

## Common Causes & Solutions

### Cause 1: Trying to Access 0.0.0.0 Directly ❌

**Problem:** You're trying to access `http://0.0.0.0:5001` in your browser.

**Why it fails:** `0.0.0.0` is a special "bind all interfaces" address that services listen on, but browsers cannot access it directly.

**Solution:** Use `localhost` or `127.0.0.1` instead:
```bash
# ❌ DON'T use:
http://0.0.0.0:5001

# ✅ USE instead:
http://localhost:5001
# OR
http://127.0.0.1:5001
```

---

### Cause 2: MLflow Server Not Running

**Check if server is running:**
```bash
# Check Docker container
docker ps | grep mlflow-server

# Check local mlflow ui
ps aux | grep "mlflow ui"

# Check ports
lsof -i :5001  # Docker MLflow
lsof -i :5000  # Local MLflow UI
```

**Solution - Start MLflow Server:**

**Option A: Docker MLflow Server (Port 5001)**
```bash
cd /Users/aashishr/codebase/mlso
./start_mlflow_server.sh

# Access at: http://localhost:5001
```

**Option B: Local MLflow UI (Port 5000)**
```bash
cd /Users/aashishr/codebase/mlso
mlflow ui

# Access at: http://localhost:5000
```

---

### Cause 3: Wrong Port Number

**Check which port your MLflow is running on:**

**Docker setup:** Port **5001**
```bash
# Access at:
http://localhost:5001
```

**Local mlflow ui:** Port **5000**
```bash
# Access at:
http://localhost:5000
```

---

### Cause 4: Docker Container Failed to Start

**Check container status:**
```bash
docker ps -a | grep mlflow

# If container exists but stopped, check logs:
docker logs mlflow-server

# Common issues:
# - Port already in use
# - Database connection failed
# - Missing environment variables
```

**Solution - Restart with logs:**
```bash
# Stop any existing containers
docker-compose -f docker-compose.mlflow.yml down

# Start fresh with logs
docker-compose -f docker-compose.mlflow.yml up

# Watch for errors in the startup logs
```

---

### Cause 5: Firewall or Network Restrictions

**Check firewall settings:**
```bash
# macOS - Check if firewall is blocking
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate

# Try with curl
curl http://localhost:5001/
curl http://127.0.0.1:5001/
```

**Solution:**
- Allow Docker in firewall settings
- Add exception for Python (if using local mlflow ui)

---

### Cause 6: Browser Cache or Redirect Issue

**Clear browser data:**
1. Open browser developer tools (F12)
2. Right-click refresh button
3. Select "Empty Cache and Hard Reload"

**Or try:**
```bash
# Test with curl first
curl -I http://localhost:5001/

# If curl works but browser doesn't, it's a browser issue
```

---

## Step-by-Step Troubleshooting

### Step 1: Verify Nothing is Running
```bash
# Check Docker
docker ps | grep mlflow

# Check local process
ps aux | grep mlflow | grep -v grep

# Check ports
lsof -i :5000
lsof -i :5001
```

### Step 2: Start MLflow Server
```bash
# Using Docker (recommended)
cd /Users/aashishr/codebase/mlso
./start_mlflow_server.sh

# Choose option 1 (local filesystem) for quickest test
```

### Step 3: Wait for Server to Start
```bash
# Watch the logs
docker-compose -f docker-compose.mlflow.yml logs -f mlflow-server

# Look for: "Listening at: http://0.0.0.0:5000"
# This means server is ready
```

### Step 4: Access Correct URL
```bash
# ✅ CORRECT URLs:
http://localhost:5001
http://127.0.0.1:5001

# ❌ WRONG URLs:
http://0.0.0.0:5001  # This will give 403 error
http://localhost:5000  # Wrong port (that's local mlflow ui)
```

### Step 5: Verify Server is Accessible
```bash
# Test with curl
curl http://localhost:5001/

# Should return HTML (MLflow UI page)
# If you get connection refused, server isn't running
# If you get 403, you're using wrong URL (0.0.0.0)
```

---

## Quick Fix Commands

### Fix 1: Start Docker MLflow Server
```bash
cd /Users/aashishr/codebase/mlso

# Start server
./start_mlflow_server.sh

# Wait 10-15 seconds, then access:
open http://localhost:5001
```

### Fix 2: Use Local MLflow UI Instead
```bash
cd /Users/aashishr/codebase/mlso

# Start local UI (simpler, no Docker needed)
mlflow ui

# Access at:
open http://localhost:5000
```

### Fix 3: Check and Fix Docker Issues
```bash
# Stop everything
docker-compose -f docker-compose.mlflow.yml down

# Remove old containers
docker rm -f mlflow-server mlflow-postgres 2>/dev/null

# Start fresh
docker-compose -f docker-compose.mlflow.yml up -d

# Check status
docker ps

# View logs
docker logs mlflow-server
```

---

## Testing Your Setup

### Test 1: Check if Server is Running
```bash
# Should return "UP"
docker ps --filter "name=mlflow-server" --format "{{.Status}}"
```

### Test 2: Test with Curl
```bash
# Should return HTML
curl http://localhost:5001/

# Should return 200 OK
curl -I http://localhost:5001/
```

### Test 3: Access in Browser
```bash
# Open browser
open http://localhost:5001

# You should see MLflow UI
# If you see 403, you're using 0.0.0.0 instead of localhost
```

---

## Common Mistakes

### ❌ Mistake 1: Using 0.0.0.0
```bash
# DON'T DO THIS:
http://0.0.0.0:5001  # Results in 403 error
```

### ✅ Correct Way:
```bash
# DO THIS:
http://localhost:5001  # Works!
```

### ❌ Mistake 2: Wrong Port
```bash
# Docker MLflow is on 5001, not 5000
http://localhost:5000  # This is for local mlflow ui
```

### ✅ Correct Way:
```bash
http://localhost:5001  # Docker MLflow server
```

### ❌ Mistake 3: Server Not Started
```bash
# Trying to access before starting server
open http://localhost:5001
# Connection refused or 403
```

### ✅ Correct Way:
```bash
# Start server first
./start_mlflow_server.sh
# Wait 10-15 seconds
open http://localhost:5001
```

---

## Still Getting 403?

### Debug Checklist:
- [ ] Server is running: `docker ps | grep mlflow`
- [ ] Using `localhost` not `0.0.0.0`
- [ ] Using correct port (5001 for Docker, 5000 for local)
- [ ] No firewall blocking
- [ ] Tried clearing browser cache
- [ ] Curl works: `curl http://localhost:5001/`

### If All Else Fails:
```bash
# Complete restart
docker-compose -f docker-compose.mlflow.yml down
docker system prune -f
./start_mlflow_server.sh

# Or use local MLflow UI instead:
mlflow ui
open http://localhost:5000
```

---

## Summary Table

| URL | Purpose | Status |
|-----|---------|--------|
| `http://0.0.0.0:5001` | ❌ Won't work | 403 Error |
| `http://localhost:5001` | ✅ Docker MLflow | Correct |
| `http://127.0.0.1:5001` | ✅ Docker MLflow | Correct |
| `http://localhost:5000` | ✅ Local MLflow UI | Correct |

---

## Quick Reference

**Start Docker MLflow:**
```bash
./start_mlflow_server.sh
# Access: http://localhost:5001
```

**Start Local MLflow:**
```bash
mlflow ui
# Access: http://localhost:5000
```

**Check Status:**
```bash
docker ps
curl http://localhost:5001/
```

**View Logs:**
```bash
docker logs mlflow-server
```

---

**Created:** December 28, 2025  
**Purpose:** Fix HTTP 403 error when accessing MLflow  
**Common Cause:** Trying to access 0.0.0.0 instead of localhost  
**Solution:** Use `http://localhost:5001` or `http://localhost:5000`

